<!-- Blocco visibile solo su mobile -->
<div *ngIf="isMobile" class="mobile-blocked">
  <h2>Accesso CMS non disponibile su mobile</h2>
  <p>Per motivi di sicurezza e usabilità, accedi da un dispositivo desktop.</p>
</div>

<!-- Layout CMS attivo solo su desktop -->
<div *ngIf="!isMobile" class="cms-layout">

  <!-- Sidebar sinistra: struttura ad albero -->
  <div class="cms-sidebar">

    <!-- Spinner visibile durante il caricamento delle cartelle -->
    <div *ngIf="loading" class="spinner-container">
      <mat-spinner diameter="30"></mat-spinner>
      <p>Caricamento cartelle...</p>
    </div>

    <!-- MatTree visibile solo quando il caricamento è completato -->
    <mat-tree *ngIf="!loading"
              [dataSource]="dataSource"
              [treeControl]="treeControl"
              class="folder-tree">

      <!-- Nodo con figli (anche se vuoti) -->
      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
        <div class="mat-tree-node">

          <!-- Pulsante per espandere o comprimere il nodo -->
          <button mat-icon-button matTreeNodeToggle>
            <mat-icon>
              {{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
            </mat-icon>
          </button>

          <!-- Icona cartella -->
          <mat-icon class="mr-2">folder</mat-icon>

          <!-- Contenitore che mostra il nome della cartella e i pulsanti di azione -->
<div class="node-content">

  <!-- Clic sul nome seleziona il nodo (evidenziato se è quello attualmente selezionato) -->
  <span (click)="onNodeClick(node)"
        [class.selected-node]="nodoSelezionato === node">
    {{ node.name }}
  </span>

  <!-- Pulsante per eliminare la cartella corrente -->
  <button
    mat-icon-button
    class="delete-folder-button"
    (click)="deleteFolder(node.fullPath); $event.stopPropagation();"
    aria-label="Elimina cartella">
    <!-- Icona del cestino, colorata di rosso (Angular Material) -->
    <mat-icon color="warn">delete</mat-icon>
  </button>

  <!-- Pulsante per creare una sottocartella all'interno della cartella corrente -->
  <button
    mat-icon-button
    class="create-folder-button"
    (click)="apriPopUpAddFolder(node)"
    aria-label="Aggiungi sottocartella">
    <!-- Icona della cartella nuova, colorata di blu (Angular Material) -->
    <mat-icon color="primary">create_new_folder</mat-icon>
  </button>

</div>


        </div>

        <!-- Outlet per i nodi figli -->
        <div *ngIf="treeControl.isExpanded(node)">
          <ng-container matTreeNodeOutlet></ng-container>
        </div>
      </mat-nested-tree-node>

      <!-- Nodo foglia (senza figli) -->
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
        <div class="mat-tree-node">
          <!-- Icona placeholder per allineamento -->
          <button mat-icon-button disabled>
            <mat-icon class="transparent">chevron_right</mat-icon>
          </button>
          <!-- Icona file -->
          <mat-icon class="mr-2">insert_drive_file</mat-icon>

          <!-- Nome del file o elemento -->
          <span (click)="onNodeClick(node)"
                [class.selected-node]="nodoSelezionato === node">
            {{ node.name }}
          </span>
        </div>
      </mat-tree-node>
    </mat-tree>

    <!-- Pulsante per forzare il refresh delle cartelle dal cloud -->
    <button mat-raised-button class="refresh-button" (click)="refreshFolders()">
      Refresh cartelle con il cloud
    </button>



  </div>

  <!-- Area destra per i contenuti dinamici -->
  <div class="cms-content">
    <h2>Contenuti</h2>
    <p>Qui verranno mostrati i contenuti della cartella selezionata.</p>
  </div>
</div>
