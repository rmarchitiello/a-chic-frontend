/* ============================================================
   AUDIO PANEL – SCSS UNIFICATO (template unico)
   - Usa .audio-overlay, .audio-panel, .titolo-melodie, .melodia-row
   - Pulsanti chiusura: .chiudi-testuale (mobile), .chiudi-icon (desktop)
   - Utility visibilità: .only-mobile / .only-desktop
   ============================================================ */

/* Host neutro: nessun layout extra */
:host { display: contents; }

/* ---------- Animazioni comuni ---------- */
@keyframes sheetUp   { from { transform: translateY(100%); opacity: .7; } to { transform: translateY(0); opacity: 1; } }
@keyframes sheetDown { from { transform: translateY(0);    opacity: 1;  } to { transform: translateY(100%); opacity: 0; } }
@keyframes modalIn   { from { transform: translateY(8px);  opacity: 0; } to { transform: translateY(0); opacity: 1; } }
@keyframes modalOut  { from { transform: translateY(0);    opacity: 1; } to { transform: translateY(8px); opacity: 0; } }

/* ---------- Overlay full-screen (stato base) ---------- */
.audio-overlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0);
  backdrop-filter: blur(0);
  -webkit-backdrop-filter: blur(0);
  display: flex;
  justify-content: center;
  /* l'allineamento verticale viene definito nelle media query */
  z-index: 2000;
  transition:
    background-color .35s ease,
    backdrop-filter .35s ease,
    -webkit-backdrop-filter .35s ease;
}

/* Stato attivo/chiusura comuni */
.audio-overlay.attiva {
  background-color: rgba(0, 0, 0, .45);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}
.audio-overlay.chiusura {
  background-color: rgba(0, 0, 0, 0);
  backdrop-filter: blur(0);
  -webkit-backdrop-filter: blur(0);
}

/* ---------- Pannello contenuti (base) ---------- */
.audio-panel {
  background: #fff;
  color: #222;
  width: 100%;
  max-height: 82vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative; /* per pulsanti assoluti */
  box-shadow: 0 10px 28px rgba(0,0,0,.28);
}

/* Titolo (base) */
.titolo-melodie {
  font-weight: 500;
  text-align: center;
  margin: .25rem 0 .75rem;
  color: #222;
}

/* Lista (base) */
mat-list {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  background: transparent;
}
mat-list-item {
  padding: .25rem 0;
  background: transparent !important;

  & + mat-list-item {
    position: relative;
    &::before {
      content: '';
      position: absolute;
      left: 0; right: 0; top: 0;
      height: 1px;
      background: #eee;
    }
  }
}

/* Riga melodia (base) */
.melodia-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: .75rem;

  .melodia-nome { color: #333; }

  button[mat-icon-button] { --mat-icon-font-size: 1.55rem; }

  &.is-playing .melodia-nome {
    font-weight: 700;
    color: #000;
  }
}

/* Pulsanti chiusura (base) */
.chiudi-testuale,
.chiudi-icon {
  border: 0;
  background: none;
  cursor: pointer;
}

/* Utility visibilità (base) */
.only-mobile  { display: inline-flex; }
.only-desktop { display: none; }

/* Focus accessibile */
.chiudi-testuale:focus-visible,
.chiudi-icon:focus-visible,
.melodia-row button[mat-icon-button]:focus-visible {
  outline: 2px solid #1976d2;
  outline-offset: 2px;
  border-radius: 8px;
}

/* ============================================================
   MOBILE (≤ 768px) – bottom sheet
   ============================================================ */
@media (max-width: 768px) {
  .audio-overlay {
    align-items: flex-end;            /* bottom sheet */
  }

  .audio-panel {
    height: 58vh;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    padding: 1rem 1.2rem calc(1.2rem + env(safe-area-inset-bottom));
    box-shadow: 0 -6px 18px rgba(0,0,0,.22);
    animation: sheetUp .35s ease-out both;                /* apertura */
  }
  .audio-overlay.chiusura .audio-panel {
    animation: sheetDown .28s ease-in both;               /* chiusura */
  }

  /* Titolo dimensionato per mobile */
  .titolo-melodie {
    font-size: clamp(1.4rem, 5vw, 1.9rem);
  }

  /* Riga melodia: font responsive per il nome */
  .melodia-row .melodia-nome {
    font-size: clamp(1.1rem, 4.2vw, 1.35rem);
  }

  /* Pulsante testuale di chiusura (mobile) */
  .chiudi-testuale {
    position: absolute;
    top: 0;
    right: 1rem;
    transform: translateY(-1.25rem);
    color: #fcfafa;
    font: 500 .95rem/1 'Montserrat', sans-serif;
    padding: .25rem;

    &:hover  { opacity: .75; text-decoration: underline; }
    &:active { opacity: .55; }
  }

  /* Mostra UI mobile / Nasconde UI desktop */
  .only-mobile  { display: inline-flex !important; }
  .only-desktop { display: none !important; }
}

/* ============================================================
   DESKTOP (≥ 769px) – modal centrata
   ============================================================ */
@media (min-width: 769px) {
  .audio-overlay {
    align-items: center;             /* modal centrata */
  }

  .audio-panel {
    width: 520px;
    max-width: 92vw;
    height: auto;
    max-height: 78vh;
    border-radius: 16px;             /* tutti i lati arrotondati */
    padding: 2rem 1.5rem;
    animation: modalIn .28s ease-out both;                /* apertura */
  }
  .audio-overlay.chiusura .audio-panel {
    animation: modalOut .22s ease-in both;                /* chiusura */
  }

  .titolo-melodie {
    font-size: clamp(1.6rem, 2vw, 1.9rem);
  }

  .melodia-row .melodia-nome {
    font-size: 1.15rem;
  }
  .melodia-row button[mat-icon-button] {
    --mat-icon-font-size: 1.4rem;
  }

  /* Pulsante icona (desktop) */
  .chiudi-icon {
    position: absolute;
    top: .75rem;
    right: .75rem;
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,.2);
    display: flex; align-items: center; justify-content: center;
    transition: background-color .2s ease;

    mat-icon { font-size: 1.4rem; color: #333; }
    &:hover  { background-color: #f2f2f2; }
    &:active { background-color: #e6e6e6; }
  }

  /* Mostra UI desktop / Nasconde UI mobile */
  .only-mobile  { display: none !important; }
  .only-desktop { display: inline-flex !important; }
}
