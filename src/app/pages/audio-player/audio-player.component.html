<!-- ===============================================================
     PANNELLO AUDIO (UNICO TEMPLATE)
     - L'overlay copre tutta la pagina quando 'attivo' è true
     - Le transizioni di apertura/chiusura sono gestite da:
         • classi: .attiva / .chiusura
         • animazione: [@panelSlideAnimation]
     - Accessibilità: role="dialog" + aria-modal
   =============================================================== -->

<!-- OVERLAY + PANEL (template unico) -->
<div
  class="audio-overlay"
  [ngClass]="{ 'attiva': attivo, 'chiusura': panelClosing }"
  (click)="closeWindow()"
  [attr.aria-hidden]="!attivo"
  role="dialog"
  aria-modal="true"
>
  <div
    class="audio-panel"
    [@panelSlideAnimation]="panelAnimationState"
    (click)="$event.stopPropagation()"
  >
    <!-- Chiudi: versione mobile (testo) -->
    <button
      type="button"
      class="chiudi-testuale only-mobile"
      (click)="closeWindow()"
      aria-label="Chiudi pannello audio"
    >
      Chiudi
    </button>

    <!-- Chiudi: versione desktop (icona) -->
    <button
      type="button"
      class="chiudi-icon only-desktop"
      mat-icon-button
      (click)="closeWindow()"
      aria-label="Chiudi pannello audio"
    >
      <mat-icon>close</mat-icon>
    </button>

    <!-- Titolo -->
    <h2 class="titolo-melodie">Melodie disponibili</h2>

    <!-- Lista tracce -->
    <mat-list role="list">
      <mat-list-item
        role="listitem"
        *ngFor="let audio of assetCarllonAudioUrl; let i = index"
      >
        <div
          class="melodia-row"
          [class.is-playing]="currentIndex === i && isPlaying"
        >
          <span class="melodia-nome">{{ audio.nome_canzone }}</span>

          <button
            type="button"
            mat-icon-button
            (click)="togglePlay(audio.url, i)"
            [attr.aria-label]="(currentIndex === i && isPlaying) ? 'Metti in pausa' : 'Riproduci'"
          >
            <mat-icon>
              {{ (currentIndex === i && isPlaying) ? 'pause' : 'play_arrow' }}
            </mat-icon>
          </button>
        </div>
      </mat-list-item>
    </mat-list>

    <!-- Audio element -->
    <audio #audioPlayer (ended)="onEnded()"></audio>
  </div>
</div>
