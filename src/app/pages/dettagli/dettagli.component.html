<!-- DETTAGLI: TEMPLATE UNICO (mobile + desktop) -->
<div
  class="dettagli-overlay"
  [class.attiva]="attivo"
  [class.chiusura]="panelClosing"
  [class.mobile]="isMobile"
  [class.desktop]="!isMobile"
  (click)="closeWindow()"
  role="dialog"
  [attr.aria-modal]="'true'"
  [attr.aria-hidden]="attivo ? null : 'true'">

  <!-- PANNELLO -->
  <div
    class="dettagli-panel"
    [class.mobile]="isMobile"
    [class.desktop]="!isMobile"
    (click)="$event.stopPropagation()">

    <!-- Pulsante CHIUDI (testuale su mobile, icona su desktop) -->
    <button
      *ngIf="isMobile"
      class="chiudi-testuale"
      type="button"
      (click)="closeWindow()">
      Chiudi
    </button>

    <button
      *ngIf="!isMobile"
      class="chiudi-icon"
      type="button"
      (click)="closeWindow()"
      aria-label="Chiudi"
      mat-icon-button>
      <mat-icon>close</mat-icon>
    </button>

    <!-- FRECCE NAVIGAZIONE (desktop; visibili solo con più media) -->
    <button
      *ngIf="!isMobile && totaleImmagini.length > 1"
      class="freccia freccia-sinistra"
      type="button"
      (click)="vaiImmaginePrecedente()"
      [disabled]="currentIndexOtherImage === 0"
      aria-label="Precedente"
      mat-icon-button>
      <mat-icon>chevron_left</mat-icon>
    </button>

    <button
      *ngIf="!isMobile && totaleImmagini.length > 1"
      class="freccia freccia-destra"
      type="button"
      (click)="vaiImmagineSuccessiva()"
      [disabled]="currentIndexOtherImage === (totaleImmagini.length - 1)"
      aria-label="Successiva"
      mat-icon-button>
      <mat-icon>chevron_right</mat-icon>
    </button>

    <!-- STAGE MEDIA (con swipe su mobile) -->
    <div
      class="media-stage"
      [class.swipeable]="isMobile"
      (touchstart)="isMobile && onTouchStart($event)"
      (touchend)="isMobile && onTouchEnd($event)"
      [@slideAnimation]="animationState"
      (@slideAnimation.done)="onSlideDone($event)">

      <!-- SWITCH MEDIA: image / video / audio / fallback -->
      <ng-container [ngSwitch]="true">

        <!-- IMMAGINE -->
        <img
          *ngSwitchCase="checkEstensione(currentMediaUrl, 'image')"
          class="media-image"
          [src]="currentMediaUrl"
          [alt]="descrizioneImmagineFrontale || 'Media A-Chic'" />

        <!-- VIDEO -->
        <video
          *ngSwitchCase="checkEstensione(currentMediaUrl, 'video')"
          class="media-video"
          controls
          playsinline
          preload="metadata">
          <source [src]="currentMediaUrl" />
          Il tuo browser non supporta il tag video.
        </video>

        <!-- AUDIO -->
        <audio
          *ngSwitchCase="checkEstensione(currentMediaUrl, 'audio')"
          class="media-audio"
          controls
          preload="metadata">
          <source [src]="currentMediaUrl" />
          Il tuo browser non supporta il tag audio.
        </audio>

        <!-- FALLBACK: tratto come immagine -->
        <img
          *ngSwitchDefault
          class="media-image"
          [src]="currentMediaUrl"
          [alt]="descrizioneImmagineFrontale || 'Media A-Chic'" />
      </ng-container>
    </div>

    <!-- INDICATORI (pallini) -->
    <div
      *ngIf="totaleImmagini.length > 1"
      class="indicator-wrapper"
      aria-label="Indicatori media">
      <span
        *ngFor="let m of totaleImmagini; let i = index; trackBy: trackByIndex"
        [class.attiva]="i === currentIndexOtherImage">
        ●
      </span>
    </div>

    <!-- DESCRIZIONE -->
    <p class="descrizione-scroll">
      {{ descrizioneImmagineFrontale }}
    </p>
  </div>
</div>
