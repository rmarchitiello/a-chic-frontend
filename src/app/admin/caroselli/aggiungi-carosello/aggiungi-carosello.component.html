<!--
  Struttura:
  - Header con titolo e sottotitolo
  - Campi sempre visibili: Nome carosello, Titolo carosello (entrambi con icona info)
  - Sezioni espandibili (Opzioni, Opzioni avanzate, Plugin, Stile e animazioni)
  - Ogni mat-form-field è avvolto in .field-with-info con un pulsante info a destra
-->

<!-- =============================================================================
  DIALOG CAROSELLO — TEMPLATE COMPLETO
  - Aggiungo una classe opzionale .form-carosello--full per eliminare i margini
    laterali e il max-width (così non vedi “grigio” ai lati nel dialog).
    Nel tuo SCSS: .form-carosello--full { max-width:100%; margin:0; }
  - Inserisco un pulsante info (mat-icon-button + tooltip) per TUTTI i campi,
    inclusi i mat-slide-toggle, usando due wrapper:
      • .field-with-info  → mat-form-field + icona a destra
      • .toggle-with-info → slide-toggle + icona a destra
  - Mantengo floatLabel="always" su tutti i mat-form-field.
============================================================================== -->

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-carosello form-carosello--full">
  <!-- BTN CHIUDI (type=button per evitare submit) -->
  <button type="button" class="chiudi-btn" matTooltip="Chiudi" [matTooltipClass]="'tooltip-custom'" (click)="chiudiDialog()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- HEADER -->
  <h2 class="form-title">
    <mat-icon color="primary" aria-hidden="true">add_to_photos</mat-icon>
    <span>Crea il tuo carosello</span>
  </h2>
  <p class="form-subtitle">Imposta i campi principali e apri le sezioni per configurare il resto.</p>

  <!-- CAMPI SEMPRE VISIBILI -->
  <div class="field-with-info">
    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Nome carosello</mat-label>
      <mat-icon matPrefix aria-hidden="true">drive_file_rename_outline</mat-icon>
      <input matInput type="text" formControlName="name" autocomplete="off" required />
      <mat-hint align="end">Es. “Hero”, “Modelli in evidenza”</mat-hint>
      <mat-error *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched">Obbligatorio</mat-error>
      <mat-error *ngIf="form.get('name')?.hasError('pattern') && form.get('name')?.touched">Non puoi inserire caratteri speciali</mat-error>
    </mat-form-field>

    <button type="button" mat-icon-button class="info-label"
            matTooltip="Nome leggibile usato in UI e pannello admin. Ammesse lettere, numeri, spazi, _ e -."
            matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
            aria-label="Info: Nome carosello">
      <mat-icon>info</mat-icon>
    </button>
  </div>

  <div class="field-with-info">
    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Titolo carosello</mat-label>
      <mat-icon matPrefix aria-hidden="true">title</mat-icon>
      <input matInput type="text" formControlName="titoloSezione" placeholder="Es. Best seller" />
    </mat-form-field>

    <button type="button" mat-icon-button class="info-label"
            matTooltip="Titolo mostrato sopra al carosello (H2). Puoi lasciarlo vuoto se non serve."
            matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
            aria-label="Info: Titolo carosello">
      <mat-icon>info</mat-icon>
    </button>
  </div>

  <!-- SEZIONI ESPANDIBILI -->
  <mat-accordion multi="true" displayMode="flat">

    <!-- Opzioni -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon aria-hidden="true">tune</mat-icon>
          <span style="margin-left:8px">Opzioni</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="field-with-info">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Allineamento (align)</mat-label>
          <mat-icon matPrefix aria-hidden="true">format_align_center</mat-icon>
          <mat-select formControlName="align" required>
            <mat-option value="center">center</mat-option>
            <mat-option value="prev">prev</mat-option>
            <mat-option value="next">next</mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('align')?.hasError('required')">Obbligatorio</mat-error>
        </mat-form-field>

        <button type="button" mat-icon-button class="info-label"
                matTooltip="Posizione del pannello attivo: center = centrato, prev = verso sinistra, next = verso destra."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Allineamento">
          <mat-icon>info</mat-icon>
        </button>
      </div>

      <div class="field-with-info">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Modalità (mode)</mat-label>
          <mat-icon matPrefix aria-hidden="true">tune</mat-icon>
          <mat-select formControlName="mode" required>
            <mat-option value="no-scroll">no-scroll</mat-option>
            <mat-option value="snap">snap</mat-option>
            <mat-option value="freeScroll">freeScroll</mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('mode')?.hasError('required')">Obbligatorio</mat-error>
        </mat-form-field>

        <button type="button" mat-icon-button class="info-label"
                matTooltip="Comportamento dello scorrimento: no-scroll = fermo, snap = aggancia alle card, freeScroll = inerzia libera."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Modalità">
          <mat-icon>info</mat-icon>
        </button>
      </div>

      <div class="field-with-info">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Durata</mat-label>
          <mat-icon matPrefix aria-hidden="true">speed</mat-icon>
          <input matInput type="number" formControlName="duration" required />
          <span matSuffix>ms</span>
          <mat-hint align="end">0 = istantaneo (senza animazione)</mat-hint>
          <mat-error *ngIf="form.get('duration')?.hasError('required')">Obbligatorio</mat-error>
        </mat-form-field>

        <button type="button" mat-icon-button class="info-label"
                matTooltip="Durata dell’animazione tra pannelli (millisecondi). 0 = cambio immediato."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Durata">
          <mat-icon>info</mat-icon>
        </button>
      </div>
    </mat-expansion-panel>

    <!-- Opzioni avanzate (interruttori non-plugin) -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon aria-hidden="true">toggle_on</mat-icon>
          <span style="margin-left:8px">Opzioni avanzate</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="toggle-with-info">
        <mat-slide-toggle color="primary" formControlName="circular">
          Scorrimento infinito (circular)
        </mat-slide-toggle>
        <button type="button" mat-icon-button class="info-label"
                matTooltip="Se attivo, dopo l’ultima slide si torna alla prima senza interruzioni."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Scorrimento infinito">
          <mat-icon>info</mat-icon>
        </button>
      </div>

      <div class="toggle-with-info">
        <mat-slide-toggle color="primary" formControlName="zoomMediaCarosello">
          Effetto zoom sul media al cambio slide
        </mat-slide-toggle>
        <button type="button" mat-icon-button class="info-label"
                matTooltip="Applica un leggero zoom al media durante la transizione tra le slide."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Effetto zoom">
          <mat-icon>info</mat-icon>
        </button>
      </div>
    </mat-expansion-panel>

    <!-- Plugin -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon aria-hidden="true">extension</mat-icon>
          <span style="margin-left:8px">Plugin</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div formGroupName="plugins">
        <div class="toggle-with-info">
          <mat-slide-toggle color="primary" formControlName="arrow">
            Frecce di navigazione (prev/next)
          </mat-slide-toggle>
          <button type="button" mat-icon-button class="info-label"
                  matTooltip="Mostra le frecce laterali per spostarsi tra le slide."
                  matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                  aria-label="Info: Frecce di navigazione">
            <mat-icon>info</mat-icon>
          </button>
        </div>

        <div class="toggle-with-info">
          <mat-slide-toggle color="primary" formControlName="fade">
            Transizione in dissolvenza (fade)
          </mat-slide-toggle>
          <button type="button" mat-icon-button class="info-label"
                  matTooltip="Usa una dissolvenza tra le slide invece di uno scorrimento."
                  matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                  aria-label="Info: Transizione fade">
            <mat-icon>info</mat-icon>
          </button>
        </div>

        <div class="toggle-with-info">
          <mat-slide-toggle color="primary" formControlName="bullet">
            Indicatori di pagina (pallini)
          </mat-slide-toggle>
          <button type="button" mat-icon-button class="info-label"
                  matTooltip="Mostra i pallini di paginazione sotto al carosello."
                  matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                  aria-label="Info: Indicatori di pagina">
            <mat-icon>info</mat-icon>
          </button>
        </div>

        <div class="field-with-info">
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Autoplay</mat-label>
            <mat-icon matPrefix aria-hidden="true">av_timer</mat-icon>
            <input matInput type="number" formControlName="autoplay" />
            <span matSuffix>ms</span>
            <mat-hint align="end">0 = disattivo</mat-hint>
          </mat-form-field>

          <button type="button" mat-icon-button class="info-label"
                  matTooltip="Intervallo tra cambi automatici (in millisecondi). 0 = nessun autoplay."
                  matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                  aria-label="Info: Autoplay">
            <mat-icon>info</mat-icon>
          </button>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Stile e animazioni -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon aria-hidden="true">brush</mat-icon>
          <span style="margin-left:8px">Stile e animazioni</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="field-with-info">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Classi wrapper</mat-label>
          <mat-icon matPrefix aria-hidden="true">view_carousel</mat-icon>
          <input matInput formControlName="wrapperClass" placeholder="Es. wrapper-carosello by-2" required />
          <mat-hint align="end">Separale con spazio o virgola</mat-hint>
          <mat-error *ngIf="form.get('wrapperClass')?.hasError('required')">Obbligatorio</mat-error>
        </mat-form-field>

        <button type="button" mat-icon-button class="info-label"
                matTooltip="Classi CSS applicate al contenitore esterno del carosello."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Classi wrapper">
          <mat-icon>info</mat-icon>
        </button>
      </div>

      <div class="field-with-info">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Classi pannello</mat-label>
          <mat-icon matPrefix aria-hidden="true">layers</mat-icon>
          <input matInput formControlName="panelClass" placeholder="Es. pannelli-carosello" required />
          <mat-error *ngIf="form.get('panelClass')?.hasError('required')">Obbligatorio</mat-error>
        </mat-form-field>

        <button type="button" mat-icon-button class="info-label"
                matTooltip="Classi CSS applicate a ciascun pannello/slide del carosello."
                matTooltipPosition="above" [matTooltipShowDelay]="200" [matTooltipClass]="'tooltip-custom'"
                aria-label="Info: Classi pannello">
          <mat-icon>info</mat-icon>
        </button>
      </div>
    </mat-expansion-panel>

  </mat-accordion>

  <!-- AZIONI -->
  <div class="actions">
    <button mat-stroked-button type="button" mat-dialog-close>Annulla</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Salva</button>
  </div>
</form>
