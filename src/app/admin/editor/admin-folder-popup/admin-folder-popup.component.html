<!-- Se notiamo bene, 
  ogni path ha sempre nodoCorrente e fullPath anche il campo child, quindi creo un template ricorsivo

-->

<!-- in pratica sto creando una variabile locale al template
 con let-nodoInput e per usarla faccio nodoInput.qualcosa
 
 let-nodoInput="nodoDiInputAlTemplate e il context cioe ci sara un div un ng container
 da qualche parte del codice che fara context: { nodoDiInputAlTemplate: node }
 e quindi vuol dire che nodoInput vale il context passato in quel momento"
 -->
<!--
  Template ricorsivo per rappresentare un nodo TreeNode.
  - let-nodoInput="nodoDiInputAlTemplate": crea la variabile locale "nodoInput"
    mappandola dalla proprietÃ  passata nel context da ngTemplateOutlet.
-->
<!-- Template ricorsivo -->
<!-- =========================
     TEMPLATE RICORSIVO ALBERO CARTELLE
     ========================= -->

<!-- Template ricorsivo per singolo nodo -->
<ng-template #rappresentaTree let-nodoInput="nodoDiInputAlTemplate">
  <div class="folder-node">
    <!-- HEADER NODO -->
    <div class="folder-node__header">
      <!-- Nome cartella -->
      <span class="folder-node__label">{{ nodoInput.nodoCorrente }}</span>

      <!-- Menu azioni (tre puntini) -->
      <button mat-icon-button class="node-menu-btn" [disabled]="isLoading" [matMenuTriggerFor]="menuNodo">
        <mat-icon>more_vert</mat-icon>
      </button>

      <!-- Menu Material -->
      <mat-menu #menuNodo="matMenu" class="menu-card-actions node-menu">
        <button mat-menu-item (click)="onRinomina(nodoInput.fullPath)">
          <mat-icon>drive_file_rename_outline</mat-icon><span>Rinomina</span>
        </button>
        <button mat-menu-item (click)="onAggiungi(false,nodoInput.fullPath)">
          <mat-icon>add</mat-icon><span>Aggiungi sottocartella</span>
        </button>
        <button mat-menu-item class="cancella" (click)="onCancella(nodoInput.fullPath)">
          <mat-icon>delete</mat-icon><span>Elimina</span>
        </button>
      </mat-menu>
    </div>

    <!-- FIGLI -->
    <div class="folder-node__children" *ngIf="nodoInput.child?.length > 0">
      <div class="folder-node__child" *ngFor="let n of nodoInput.child">
        <ng-container
          [ngTemplateOutlet]="rappresentaTree"
          [ngTemplateOutletContext]="{ nodoDiInputAlTemplate: n }"
        ></ng-container>
      </div>
    </div>
  </div>
</ng-template>

<!-- =========================
     RADICE ALBERO
     ========================= -->
<div class="folder-container">
  <!-- HEADER POPUP -->
  <div class="folder-header">
    <!-- Pulsante Chiudi -->
    <button class="chiudi-btn" matTooltip="Chiudi" [matTooltipClass]="'tooltip-custom'" (click)="chiudiDialog()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-progress-bar *ngIf="isLoading" mode="indeterminate" color="primary"></mat-progress-bar>


  <!-- Pulsante Aggiungi cartella principale -->
  <div class="add-root-btn-wrapper">
    <button mat-raised-button color="primary" (click)="onAggiungi(true)" [disabled]="isLoading">
      <mat-icon>create_new_folder</mat-icon>
      Aggiungi cartella principale
    </button>
  </div>

  <!-- LISTA NODI RADICE -->
  <div class="folder-tree">
    <div *ngFor="let rootNode of tree">
      <ng-container
        [ngTemplateOutlet]="rappresentaTree"
        [ngTemplateOutletContext]="{ nodoDiInputAlTemplate: rootNode }"
      ></ng-container>
    </div>
  </div>
</div>
