<div class="popup-container">

  <!-- Pulsante di chiusura in alto a destra -->
  <button class="chiudi-btn" (click)="chiudiDialog()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Titolo del popup -->
  <h2>Modifica dei metadati</h2>

  <!-- Ciclo dinamico sui metadati -->
  <div
    *ngFor="let context of contextModificabile(); trackBy: trackByKey"
  >
    <!-- Etichetta chiave del metadato -->
    <p class="campo-key">{{ context.key }}</p>

    <!-- Visualizzazione normale (testo statico) -->
    <p class="descrizione-testo" *ngIf="!isEditing">
      {{ context.value }}
    </p>

    <!-- MODIFICA DEGLI INPUTS-->
<!-- Se il campo è "descrizione", usa textarea -->
<textarea
  *ngIf="isEditing && context.key === 'descrizione'"
  class="campo-input"
  [(ngModel)]="mediaContextMap[context.key]"
  [placeholder]="context.key"
  rows="3"
></textarea>

<!-- Per tutti gli altri campi, usa input normale -->
<input
  *ngIf="isEditing && context.key !== 'descrizione'"
  class="campo-input"
  [(ngModel)]="mediaContextMap[context.key]"
  [placeholder]="context.key"
  [type]="isCampoNumerico(context.key) ? 'number' : 'text'"
/>
  </div>

  <!-- Pulsante Conferma modifiche (visibile solo se serve confermare) -->
  <div *ngIf="modificaInAttesaDiConferma" class="azioni-finali">
    <button
      mat-stroked-button
      color="accent"
      class="btn-conferma"
      (click)="confermaModificaContext()"
    >
      Conferma
    </button>
  </div>

  <!-- Sezione pulsanti azione -->
  <div class="azioni-popup">

    <!-- Pulsante Modifica (visibile solo se non si sta già modificando) -->
    <button
      mat-icon-button
      class="btn-edit-icon"
      *ngIf="!isEditing"
      (click)="attivaModifica()"
      aria-label="Modifica"
    >
      <mat-icon>edit</mat-icon>
    </button>

    <!-- Pulsanti Salva e Annulla (solo in modalità modifica) -->
    <div *ngIf="isEditing" class="azioni-editing">
      <button mat-raised-button color="primary" (click)="salvaModifica()">Salva</button>
      <button mat-button color="warn" (click)="annullaModifica()">Annulla</button>
    </div>

  </div>
</div>
