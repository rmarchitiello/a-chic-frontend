<!-- Contenitore principale con scroll interno -->
<div class="dialog-scroll-content">

  <!-- Pulsante per chiudere il dialog -->
  <button class="chiudi-btn" matTooltip="Chiudi" (click)="chiudiDialog()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Contenuto principale del form -->
  <div class="upload-main-content">

    <!-- Titolo del dialog -->
    <h2 class="titolo-form">Modifica metadati del file</h2>

    <!-- Contenitore della lista di metadati -->
    <div class="form-metadata">

      <!-- Ciclo su tutte le chiavi dei metadati -->
      <!-- Ciclo su tutte le chiavi dei metadati -->
      <div class="metadata-pair" *ngFor="let chiave of tutteLeChiavi; let i = index"
        [ngClass]="{ 'duplicata': isChiaveDuplicata(chiave, i) }">

        <!-- Campo chiave (disabilitato se protetta) -->
        <mat-form-field appearance="outline" floatLabel="always">
          <input matInput [disabled]="isChiaveProtetta(chiave)"
          (ngModelChange)="onRenameChiave(i, $event); onCheckChiave($event)"

          [(ngModel)]="tutteLeChiavi[i]" [name]="'chiave_' + i"
            [placeholder]="normalizzaChiave(chiave)" />

          <!-- Messaggio di errore visivo semplice -->
          <div *ngIf="isChiaveDuplicata(chiave, i)" class="errore-duplicato">
            Chiave già presente
          </div>
        </mat-form-field>

        <!-- Campo valore (modificabile sempre) -->
        <mat-form-field appearance="outline" floatLabel="always">
          <input matInput [type]="isNumericKey(chiave) ? 'number' : 'text'"
            (ngModelChange)="onCheckValore($event)"
          [(ngModel)]="mapContextInputData[chiave]"
            [name]="'valore_' + i" [placeholder]="isNumericKey(chiave) ? 'es. 29.90' : 'es. pelle'" />
        </mat-form-field>

        <!-- Bottone per eliminare il metadato (solo se non è protetto) -->
        <button mat-icon-button *ngIf="!isChiaveProtetta(chiave)" color="warn" type="button"
          (click)="rimuoviMetadato(i)" matTooltip="Rimuovi metadato">
          <mat-icon>delete</mat-icon>
        </button>

      </div>



      <!-- Pulsante per aggiungere un nuovo metadato -->
      <button mat-stroked-button class="add-metadata-btn"   type="button" (click)="aggiungiMetadato()">
        + Aggiungi metadato
      </button>

      <!-- Azioni in fondo (annulla / conferma) -->
      <div class="azioni-footer">
        <button mat-button color="warn" (click)="chiudiDialog()">Annulla</button>
        <button mat-flat-button color="primary" (click)="conferma()">Salva modifiche</button>
      </div>

    </div>
  </div>
</div>