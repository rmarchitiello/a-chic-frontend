<!-- Contenuto principale del dialog -->
<div mat-dialog-content class="download-dialog-content">

  <!-- Pulsante chiudi -->
  <button mat-icon-button class="chiudi-btn" matTooltip="Chiudi" *ngIf="!downloadInCorso && !checkDataIsEmpty"
    (click)="chiudiPopUp()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Overlay durante il download -->
  <div class="eliminazione-overlay" *ngIf="downloadInCorso">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Download in corso...</p>
  </div>

  <!-- Se ci sono dati -->
  <ng-container *ngIf="!checkDataIsEmpty; else noData">
    <div class="preview-container" [class.blur]="downloadInCorso">

      <ng-container *ngFor="let media of mediaInput">
        <div class="preview-wrapper card-multiview">

          <div class="preview-multi">
            <!-- Tasto PREV solo se ci sono più immagini -->
            <button *ngIf="getMediaNoFrontale(media).length > 0"
                    mat-icon-button class="prev-btn"
                    (click)="prevImage(media.display_name)">
              <mat-icon>chevron_left</mat-icon>
            </button>

            <!-- Immagine attiva -->
            <ng-container *ngIf="getActiveAsset(media.display_name) as active">
              <div class="media-item">
                <img *ngIf="media.type === 'image'" [src]="active.url" alt="preview" class="preview-img" />
                <video *ngIf="media.type === 'video'" [src]="active.url" autoplay muted loop playsinline class="preview-img"></video>
                <audio *ngIf="media.type === 'audio'" [src]="active.url" autoplay class="preview-audio"></audio>

                <!-- Bottone download -->
                <button mat-icon-button class="download-btn"
                        (click)="downloadSingoloAsset(active, media.display_name)">
                  <mat-icon>download</mat-icon>
                </button>
              </div>
            </ng-container>

            <!-- Altre angolazioni (sovrapposte) -->
            <ng-container *ngFor="let extra of getMediaNoFrontale(media)">
              <div class="media-item extra-angle">
                <img *ngIf="media.type === 'image'" [src]="extra.url" alt="extra" class="preview-img" />
                <video *ngIf="media.type === 'video'" [src]="extra.url" autoplay muted loop playsinline class="preview-img"></video>
                <audio *ngIf="media.type === 'audio'" [src]="extra.url" autoplay class="preview-audio"></audio>
              </div>
            </ng-container>

            <!-- Tasto NEXT solo se ci sono più immagini -->
            <button *ngIf="getMediaNoFrontale(media).length > 0"
                    mat-icon-button class="next-btn"
                    (click)="nextImage(media.display_name)">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <!-- Nome sotto -->
          <p>{{ media.display_name }}</p>
        </div>
      </ng-container>

    </div>
  </ng-container>

  <!-- Nessun dato -->
  <ng-template #noData>
    <div class="no-data-message">
      <mat-icon>info</mat-icon>
      <p>Non ci sono file da scaricare.</p>
    </div>
  </ng-template>
</div>

<!-- Azioni -->
<div mat-dialog-actions class="download-dialog-actions" align="end" [class.blur]="downloadInCorso"
  *ngIf="!checkDataIsEmpty">
  <button mat-flat-button color="warn" type="button" (click)="downloadTutti()">Scarica tutto</button>
</div>
