<!-- Contenuto principale del dialog -->
<div mat-dialog-content class="delete-dialog-content">

  <!-- Se ci sono media, mostra contenuto normale -->
  <ng-container *ngIf="!checkDataIsEmpty; else noMediaTemplate">

    <button mat-icon-button class="chiudi-btn" matTooltip="Chiudi" *ngIf="!eliminazioneInCorso" (click)="chiudiDialog(true)">
      <mat-icon>close</mat-icon>
    </button>

    <!-- Overlay con spinner visibile durante l'eliminazione -->
    <div class="eliminazione-overlay" *ngIf="eliminazioneInCorso">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Eliminazione in corso...</p>
    </div>

    <!-- Contenitore anteprime media -->
    <div class="preview-container" [class.blur]="eliminazioneInCorso">
      <ng-container *ngFor="let img of mediaInput">
        <div *ngIf="!img.inEliminazione"
             class="preview-wrapper"
             [ngClass]="{
               'errore': img.erroreEliminazione,
               'in-eliminazione': img.inEliminazione
             }"
             [matTooltip]="img.dettaglioErrore || ''"
             matTooltipPosition="above">

          <!-- Pulsante elimina singolo media -->
          <button class="delete-btn"
                  mat-icon-button
                  color="warn"
                  aria-label="Elimina media"
                  (click)="deleteMedia(false, img)">
            <mat-icon>delete</mat-icon>
          </button>

          <!-- Anteprima dinamica: immagine / video / audio -->
          <ng-container *ngIf="getMediaFrontale(img) as mediaFrontale">
            <ng-container [ngSwitch]="img.type">

              <!-- Immagine -->
              <img *ngSwitchCase="'image'"
                   [src]="mediaFrontale.url"
                   [alt]="img.display_name"
                   class="preview-img" />

              <!-- Video -->
              <video *ngSwitchCase="'video'"
                     [src]="mediaFrontale.url"
                     autoplay
                     muted
                     loop
                     playsinline
                     class="preview-img"
                     style="pointer-events: none;">
              </video>

              <!-- Audio -->
              <audio *ngSwitchCase="'audio'"
                     [src]="mediaFrontale.url"
                     autoplay
                     class="preview-audio"
                     style="pointer-events: none;">
              </audio>

              <!-- Fallback -->
              <div *ngSwitchDefault class="anteprima-non-disponibile">
                <mat-icon>error_outline</mat-icon>
                <span>Tipo non supportato</span>
              </div>

            </ng-container>
          </ng-container>

          <!-- Nome del file -->
          <p>{{ img.display_name }}</p>
        </div>
      </ng-container>
    </div>

  </ng-container>

  <!-- Template alternativo se nessun file da eliminare -->
  <ng-template #noMediaTemplate>
    <div class="messaggio-nessun-media">
      <mat-icon>info</mat-icon>
      <p>Nessun file disponibile da eliminare.</p>
    </div>
  </ng-template>

</div>

<!-- Azioni in basso, solo se ci sono media -->
<div mat-dialog-actions align="end"
     class="delete-dialog-actions"
     [class.blur]="eliminazioneInCorso"
     *ngIf="!checkDataIsEmpty">

  <!-- Pulsante Annulla -->
  <button mat-stroked-button
          color="primary"
          type="button"
          (click)="annulla()">
    Annulla
  </button>

  <!-- Pulsante elimina tutti -->
  <button mat-flat-button
          color="warn"
          type="button"
          (click)="deleteMedia(true)">
    Elimina tutti i media
  </button>
</div>
