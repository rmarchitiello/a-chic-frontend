<!-- Contenuto principale del dialog -->
<div mat-dialog-content class="delete-dialog-content">

  <!-- Pulsante chiudi -->
  <button mat-icon-button class="chiudi-btn"  *ngIf="!eliminazioneInCorso && !checkDataIsEmpty"
    (click)="chiudiDialog()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Overlay durante l'eliminazione -->
  <div class="eliminazione-overlay" *ngIf="eliminazioneInCorso">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Eliminazione in corso...</p>
  </div>

  <!-- Se ci sono media -->
  <ng-container *ngIf="!checkDataIsEmpty; else noData">
    <div class="preview-container" [class.blur]="eliminazioneInCorso">

      <ng-container *ngFor="let media of mediaInput; let i = index">
        <div *ngIf="!media.inEliminazione"
             class="preview-wrapper card-multiview"
             [ngClass]="{ 'errore': media.erroreEliminazione }"
             [matTooltip]="media.dettaglioErrore || ''"
             matTooltipPosition="above">

          <div class="preview-multi">

            <!-- Tasto PREV -->
            <button *ngIf="getAllAssets(media).length > 1"
                    mat-icon-button class="prev-btn"
                    (click)="prevImage(media.display_name)"
                    >
              <mat-icon>chevron_left</mat-icon>
            </button>

            <!-- Immagine attiva -->
            <ng-container *ngIf="getActiveAsset(media.display_name) as active">
              <div class="media-item">
                <img *ngIf="media.type === 'image'" [src]="active.url" alt="preview" class="preview-img" />
                <video *ngIf="media.type === 'video'" [src]="active.url" autoplay muted loop playsinline class="preview-img"></video>
                <audio *ngIf="media.type === 'audio'" [src]="active.url" autoplay class="preview-audio"></audio>

                <!-- Pulsante Elimina -->
                <button mat-icon-button class="delete-current-btn"
                        (click)="eliminaAssetSingolo(media)"
                        
                        color="warn">
                  <mat-icon>delete_forever</mat-icon>
                </button>
              </div>
            </ng-container>

            <!-- Altre angolazioni -->
            <ng-container *ngFor="let extra of getMediaNoFrontale(media)">
              <div class="media-item extra-angle">
                <img *ngIf="media.type === 'image'" [src]="extra.url" alt="extra" class="preview-img" />
                <video *ngIf="media.type === 'video'" [src]="extra.url" autoplay muted loop playsinline class="preview-img"></video>
                <audio *ngIf="media.type === 'audio'" [src]="extra.url" autoplay class="preview-audio"></audio>
              </div>
            </ng-container>

            <!-- Tasto NEXT -->
            <button *ngIf="getAllAssets(media).length > 1"
                    mat-icon-button class="next-btn"
                    (click)="nextImage(media.display_name)"
                    >
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <!-- Nome del file -->
          <p>{{ media.display_name }}</p>
        </div>
      </ng-container>

    </div>
  </ng-container>

  <!-- Template alternativo: nessun media -->
  <ng-template #noData>
    <div class="messaggio-nessun-media">
      <mat-icon>info</mat-icon>
      <p>Nessun file disponibile da eliminare.</p>
    </div>
  </ng-template>
</div>

<!-- Azioni -->
<div mat-dialog-actions class="delete-dialog-actions" align="end" [class.blur]="eliminazioneInCorso"
  *ngIf="!checkDataIsEmpty">
  <button mat-flat-button color="warn" type="button" (click)="eliminaTuttiIMedia()">
  Elimina tutti i media
</button>

</div>
