/* =========================================================
   APP COMPONENT SCSS (ripulito + overlay)
   - Non gestisco lo scroller (è in styles.scss)
   - Qui curo layout locale, sidenav (bianca) e CDK overlay
   ========================================================= */

:host {
  /* === TOKEN (facili da cambiare) === */
  --sidenav-bg: #ffffff;        /* Colore pannello sidenav (bianco pieno) */
  --menu-text: #111111;         /* Colore testo generale voci menu         */
  --hover-bg: #f6f6f7;          /* Bg su hover (se lo vuoi disattivo: = #fff) */
  --active-bg: #f1f1f1;         /* Bg su “attiva” (se lo vuoi disattivo: = #fff) */
  --gap-l1: 12px;               /* Spazio verticale tra categorie L1       */
  --gap-l2: 8px;                /* Spazio tra sotto-categorie L2           */
  --gap-l3: 6px;                /* Spazio tra filtri L3                    */
  --pad-x: 12px;                /* Padding orizzontale comune              */

  display: flex;
  flex-direction: column;
  min-height: 100dvh; /* meglio di 100vh su mobile per le UI bars */
  font-family: 'Montserrat', sans-serif;
  color: var(--menu-text);
}

/* ==================================================================
   GLOBALI (valide per mobile e desktop) — no scroller qui
   ================================================================== */

/* Contenitori che animano l'altezza: li posso clippar senza artefatti */
.sotto-container,
.filtro-container {
  overflow: hidden;
  will-change: height, opacity;
}

/* Overlay spinner durante refresh cache */
.spinner-overlay {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(255, 255, 255, 0.6);
  z-index: 1000;
}

/* Pulsanti admin fissi */
.admin-logout {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 1000;

  button {
    font-weight: 700;
    font-size: 14px;
    padding: 6px 12px;
  }
}

/* ========= RESET TOTALE voci menu (cat / sotto-cat / filtri) =========
   Voglio elementi PIATTI: nessun bordo, nessuna ombra, niente “press”.
   Mantengo solo outline tastiera per accessibilità.                   */
.sidenav-categoria,
.sotto-categoria,
.filtro-categoria {
  display: block;
  width: 100%;
  background: #fff;                 /* coerente col pannello bianco */
  color: var(--menu-text);
  line-height: 1.3;
  border: none !important;
  box-shadow: none !important;
  transform: none !important;
  outline: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  cursor: pointer;
  word-break: break-word;
}
.sidenav-categoria:hover,
.sotto-categoria:hover,
.filtro-categoria:hover {
  background: var(--hover-bg);
  box-shadow: none !important;
}
.sidenav-categoria:active,
.sotto-categoria:active,
.filtro-categoria:active {
  background: var(--hover-bg);
  transform: none !important;
  box-shadow: none !important;
  filter: none !important;
}
.sidenav-categoria.attiva,
.sotto-categoria.attiva,
.filtro-categoria.attiva {
  background: var(--active-bg);
}
.sidenav-categoria:focus-visible,
.sotto-categoria:focus-visible,
.filtro-categoria:focus-visible {
  box-shadow: none !important;
  outline: 2px solid rgba(17, 24, 39, 0.22);
  outline-offset: 2px;
}

/* ==================================================================
   MOBILE (<= 768px)
   - Scroller = BODY (gestito in styles.scss)
   - Pannello visibile del drawer DEVE essere bianco pieno
   ================================================================== */
@media (max-width: 768px) {

  /* Wrapper layout */
  .sidenav-container {
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* Drawer mobile (wrapper) */
  mat-sidenav {
    min-width: 260px;
    max-width: 86vw;
    background-color: var(--sidenav-bg);  /* comunque bianco, ma l’inner decide */
    overflow-y: hidden;                    /* niente scroll nel menu laterale */
    display: flex;
    flex-direction: column;
    border: none;

    /* Posizionato sotto safe-area + banner (32px) + header (64px) */
    position: fixed !important;
    top: calc(env(safe-area-inset-top, 0px) + 32px + 64px);
    height: calc(100dvh - env(safe-area-inset-top, 0px) - 32px - 64px);
    z-index: 2000;
  }

  /* PANEL VISIBILE DEL SIDENAV (necessario per bianco pieno) */
  :host ::ng-deep mat-sidenav .mat-drawer-inner-container {
    background: var(--sidenav-bg) !important; /* opaco, non trasparente */
    opacity: 1 !important;
    overflow: hidden !important;              /* niente scroll interno */
    display: flex;
    flex-direction: column;
    min-height: 100%;
  }

  /* Contenuto del menu: aria in alto così “Borse” non parte attaccato */
  .sidenav-content {
    padding: 16px var(--pad-x) 12px;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l1);
    background: transparent;
  }

  /* Livello 1: Categorie root (dimensioni comode al tatto) */
  .sidenav-categoria {
    font-weight: 700;
    font-size: 16px;
    padding: 12px 14px;
    border-radius: 10px; /* se la vuoi squadrata: 0 */
    margin: 0;           /* separazione gestita da gap del contenitore */
  }

  /* Contenitore L2 (niente guide laterali) */
  .sotto-container {
    margin: 8px 0 0 0;
    padding-left: 8px;   /* lieve indentazione */
    border-left: none !important;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l2);
  }

  .sotto-categoria {
    font-weight: 600;
    font-size: 15px;
    padding: 10px 12px;
    min-height: 42px;
    border-radius: 8px;
  }

  /* Contenitore L3 (filtri) */
  .filtro-container {
    margin: 6px 0 0 0;
    padding-left: 10px;  /* ulteriore indent per profondità */
    border-left: none !important;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l3);
  }

  .filtro-categoria {
    font-weight: 600;
    font-size: 14px;
    padding: 10px 12px;
    min-height: 40px;
    border-radius: 999px; /* look pill; se non ti piace: 8px o 0 */
  }

  /* Contenitore pagina — nessuno scroll interno (scorre il body) */
  .page-container {
    overflow: visible;
    padding: 0;
    padding-bottom: 0;
  }
}


/* ==================================================================
   DESKTOP (>= 769px)
   - Scroller = .mat-sidenav-content (gestito in styles.scss)
   - Drawer affiancato; pannello bianco pieno
   - ZERO ombre/bordi sulle voci anche al click
   ================================================================== */
@media (min-width: 769px) {

  .sidenav-container {
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* Wrapper del drawer (se vuoi piattissimo, togli le due righe commentate) */
  .sidenav-container mat-sidenav,
  .sidenav-container .app-sidenav {
    width: 280px;
    max-width: 30vw;
    background: transparent;
    /* border-right: none !important; */
    /* box-shadow: none !important; */
    display: flex;
    flex-direction: column;
    overflow: hidden; /* niente scroll nel menu */
    outline: none;
    padding: 0;
  }

  /* Pannello visibile del drawer: bianco pieno */
  :host ::ng-deep mat-sidenav .mat-drawer-inner-container,
  :host ::ng-deep .app-sidenav .mat-drawer-inner-container {
    background: var(--sidenav-bg) !important;
    min-height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Contenuto del menu: aggiungo padding-top per non stare attaccati all’header */
  .sidenav-content {
    padding: 16px var(--pad-x) 8px;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l1);
  }

  /* L1: categorie (piatte, senza bordi/ombre anche in stato) */
  .sidenav-categoria {
    font-weight: 600;
    font-size: 15px;
    color: #222;
    padding: 10px 12px;
    border-radius: 10px;
    background: #fff;
    border: none !important;
    box-shadow: none !important;
    transition: background-color 160ms ease, color 160ms ease;
  }
  .sidenav-categoria:hover  { background: var(--hover-bg); }
  .sidenav-categoria.attiva { background: var(--active-bg); color: #111; }
  .sidenav-categoria:active { box-shadow: none !important; }

  /* L2: contenitore (niente guide) */
  .sotto-container {
    padding-left: 6px;
    margin: 4px 0 0 0;
    border-left: none !important;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l2);
  }

  /* L2: voce */
  .sotto-categoria {
    font-weight: 500;
    font-size: 14px;
    color: #111;
    padding: 8px 10px;
    border-radius: 8px;
    background: #fff;                 /* piatto su bianco */
    border: none !important;
    box-shadow: none !important;
    transition: background-color 140ms ease;
  }
  .sotto-categoria:hover  { background: var(--hover-bg); }
  .sotto-categoria.attiva { background: var(--active-bg); }
  .sotto-categoria:active { box-shadow: none !important; }

  /* L3: contenitore filtri */
  .filtro-container {
    padding-left: 10px;
    margin-top: 4px;
    border-left: none !important;
    display: flex;
    flex-direction: column;
    gap: var(--gap-l3);
  }

  /* L3: filtro/leaf */
  .filtro-categoria {
    background: #fff;
    color: #444;
    font-size: 13px;
    font-weight: 500;
    line-height: 1.3;
    padding: 8px 10px;
    border-radius: 8px;
    outline: none;
    border: none !important;
    box-shadow: none !important;
    transition: background-color 120ms ease;
  }
  .filtro-categoria:hover  { background: #f9fafb; }
  .filtro-categoria.attiva { background: var(--active-bg); }
  .filtro-categoria:active { box-shadow: none !important; }

  /* Contenitore pagina */
  .page-container {
    overflow: visible;
    padding: 0;
    padding-bottom: 0;
    &.home-page { padding: 0 !important; }
  }
}


/* ==================================================================
   CDK OVERLAY / ANGULAR MATERIAL DIALOG
   - Backdrop, z-index, pane e superfici
   - Preset: popup-admin-editor (fullscreen) / popup-admin-folder (dialog)
   ================================================================== */

/* Contenitore overlay sopra il sidenav */
::ng-deep .cdk-overlay-container {
  z-index: 3000 !important;  /* sidenav ~2000 ⇒ overlay sopra */
}

/* Backdrop: scurisco senza blur (metti transparent se non vuoi scurire) */
::ng-deep .cdk-overlay-backdrop {
  background: rgba(0, 0, 0, 0.48);
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Pannello generico: piatto */
::ng-deep .cdk-overlay-pane {
  z-index: 3100 !important;
  box-shadow: none;
  border: none;
}

/* Dialog container Material */
::ng-deep .mat-mdc-dialog-container {
  .mat-mdc-dialog-surface {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18); /* piatto? usa 'none' */
  }
  .mat-mdc-dialog-content {
    overflow-y: auto;
    max-height: calc(100dvh - 120px);
    -webkit-overflow-scrolling: touch;
  }
}

/* FULLSCREEN editor admin */
::ng-deep .cdk-overlay-pane.popup-admin-editor {
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  max-height: 100vh !important;
  padding: 0 !important;
  margin: 0 !important;
  top: 0 !important;
  left: 0 !important;
  pointer-events: auto !important;
  z-index: 3200 !important;
}
::ng-deep .popup-admin-editor .mat-mdc-dialog-surface {
  width: 100% !important;
  height: 100% !important;
  background: #ffffff;
  box-shadow: none !important;       /* fullscreen piatto */
  border-radius: 0 !important;
  padding: 0 !important;
  display: flex !important;
  flex-direction: column !important;
}
::ng-deep .popup-admin-editor .mat-mdc-dialog-content {
  flex: 1 1 auto !important;
  overflow-y: auto !important;
  max-height: 100% !important;
  padding: 2rem !important;
}

/* Dialog gestione cartelle admin */
::ng-deep .cdk-overlay-pane.popup-admin-folder {
  padding: 16px;
  box-sizing: border-box;
  z-index: 3200 !important;
}
::ng-deep .popup-admin-folder .mat-mdc-dialog-surface {
  width: min(980px, 92vw);
  max-height: min(86vh, 860px);
  border-radius: 16px;
  background: #fff;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18); /* piatto? usa 'none' */
  padding: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
::ng-deep .popup-admin-folder .mat-mdc-dialog-content {
  flex: 1 1 auto;
  min-height: 0; /* evita overflow sul contenuto scrollabile del dialog */
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Safety: evito stacking strani con dialog + sidenav insieme */
:host ::ng-deep .mat-drawer,
:host ::ng-deep .mat-sidenav {
  z-index: 2000;
}
